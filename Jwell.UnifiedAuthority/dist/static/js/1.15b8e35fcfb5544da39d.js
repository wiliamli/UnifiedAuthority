webpackJsonp([1],{"1kgP":function(e,t){},NccL:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=o("mvHQ"),s=o.n(n),a=o("woOf"),r=o.n(a),i=o("u4Bs"),l={data:function(){var e=this;return{parentListData:[],editDefault:{},formMenu:{EnName:"",Name:"",ParentID:"",RoleID:"",Url:"",MenuType:"",Remark:""},defaultData:{ServiceNumber:"1",CreatedBy:"Elsie",CreatedTime:"2018-09-18T01:45:50.795Z",ModifiedBy:"Li",ModifiedTime:"2018-09-18T01:45:50.795Z"},getRoles:[],btnText:"保存",loading:!1,parentLoading:!1,ruleMenu:{Name:[{required:!0,validator:function(t,o,n){if(""===o)return n(new Error("请填写菜单中文名"));setTimeout(function(){e.$publicMethod.chineseOnly(o)?n(new Error("菜单中文名只能输入中文字符")):n()},500)},trigger:"blur"}],EnName:[{required:!0,validator:function(t,o,n){if(""===o)return n(new Error("请填写菜单英文名"));setTimeout(function(){e.$publicMethod.noSpecialCharacter(o)?n(new Error("菜单英文名只能输入数字和字母")):n()},500)},trigger:"blur"}],ParentID:[{required:!0,validator:function(e,t,o){""===t?o(new Error("请选择父级菜单")):o()},trigger:"blur"}],RoleID:[{required:!0,validator:function(e,t,o){""===t?o(new Error("请至少选择一位角色")):o()}}],Url:[{required:!0,validator:function(e,t,o){""===t?o(new Error("请填写Url地址")):o()},trigger:"blur"}],MenuType:[{required:!0,validator:function(e,t,o){""===t?o(new Error("请填写菜单类型")):o()},trigger:"blur"}]}}},props:{parentList:Array,checkedRole:Array,checkedRoleId:String,btnValue:String,editData:Object},methods:{checkRole:function(){var e,t=this;e=void 0===this.formMenu.ID?0:this.formMenu.ID,Object(i.e)("/Role/GetEmployeeRolesByMenuID",{serviceNumbner:"1",menuID:e}).then(function(e){console.log("成功",e),200===e.status&&e.data.Success?(t.$bus.emit("getRoles",e.data.Data),t.$emit("openRoleModal")):t.$Message.error("未成功获取此菜单下角色信息，请再试！")}).catch(function(e){console.log("失败",e),t.$Message.error("未成功获取此菜单下角色信息，请再试！")})},handleMenu:function(e){var t=this;this.loading=!0,this.$refs[e].validate(function(e){e?(t.formMenu.Remark&&""!==t.formMenu.Remark||(t.formMenu.Remark="——"),r()(t.formMenu,t.defaultData),console.log(t.formMenu),Object(i.j)("/Menus/Save",t.formMenu).then(function(e){console.log("成功",e),200===e.status&&e.data.Success?(t.$Message.success("菜单"+t.btnText+"成功!"),t.$emit("reGetMenu"),t.formMenu={},t.getRoles=[],t.$emit("closeMenuModal")):t.$Message.error(t.btnText+"失败!"),t.loading=!1}).catch(function(e){console.log("失败",e),t.$Message.error(t.btnText+"失败!"),t.loading=!1})):(t.$Message.error("请输入正确的信息!"),t.loading=!1)})},handleCancle:function(e){this.$refs[e].resetFields()},getBtnValue:function(){this.btnText=this.btnValue,"新增"===this.btnText&&(this.getRoles=[])}},watch:{parentList:function(){this.parentListData=this.parentList},checkedRole:function(){this.getRoles=this.checkedRole},checkedRoleId:function(){this.formMenu.RoleID=this.checkedRoleId},btnValue:function(){this.getBtnValue()},editData:function(){var e=this;this.editDefault=this.editData,console.log(this.editDefault),"{}"!==s()(this.editDefault)?(this.getRoles=[],""!==this.editDefault.RoleName&&this.getRoles.push(this.editDefault.RoleName),this.formMenu.Name=this.editDefault.Name,this.formMenu.EnName=this.editDefault.EnName,this.formMenu.RoleID=this.editDefault.RoleID,this.formMenu.Url=this.editDefault.Url,this.formMenu.MenuType=this.editDefault.MenuType,this.formMenu.Remark=this.editDefault.Remark,this.formMenu.ID=this.editDefault.ID,this.parentListData.map(function(t,o){t.ID===e.editDefault.ParentID&&(e.formMenu.ParentID=t.ID)})):(this.formMenu={},this.getRoles=[],console.log("我这里是新增",this.formMenu))}}},u={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"editMenuContainer"},[o("Card",{staticClass:"menuCard",attrs:{border:""}},[o("Form",{ref:"formMenu",attrs:{model:e.formMenu,rules:e.ruleMenu,"label-width":90}},[o("FormItem",{attrs:{label:"菜单中文名",prop:"Name"}},[o("Input",{attrs:{placeholder:"请输入菜单中文名"},model:{value:e.formMenu.Name,callback:function(t){e.$set(e.formMenu,"Name",t)},expression:"formMenu.Name"}})],1),e._v(" "),o("FormItem",{attrs:{label:"菜单英文名",prop:"EnName"}},[o("Input",{attrs:{placeholder:"请输入菜单英文名"},model:{value:e.formMenu.EnName,callback:function(t){e.$set(e.formMenu,"EnName",t)},expression:"formMenu.EnName"}})],1),e._v(" "),o("FormItem",{attrs:{label:"父级菜单",prop:"ParentID"}},[o("Select",{attrs:{placeholder:"请选择父级菜单"},model:{value:e.formMenu.ParentID,callback:function(t){e.$set(e.formMenu,"ParentID",t)},expression:"formMenu.ParentID"}},e._l(e.parentListData,function(t,n){return o("Option",{key:n,attrs:{value:t.ID}},[e._v(e._s(t.Name))])}))],1),e._v(" "),o("FormItem",{staticClass:"menuChooseRole",attrs:{label:"角色选择",prop:"RoleID"}},[o("Button",{attrs:{type:"dashed"},on:{click:e.checkRole}},[e._v("选择角色")]),e._v(" "),e._l(e.getRoles,function(t,n){return o("Tag",{key:n,attrs:{color:"green"}},[e._v(e._s(t))])})],2),e._v(" "),o("FormItem",{attrs:{label:"Url",prop:"Url"}},[o("Input",{attrs:{placeholder:"请输入-XX-Url地址"},model:{value:e.formMenu.Url,callback:function(t){e.$set(e.formMenu,"Url",t)},expression:"formMenu.Url"}})],1),e._v(" "),o("FormItem",{attrs:{label:"菜单类型",prop:"MenuType"}},[o("Input",{attrs:{placeholder:"请输入菜单类型"},model:{value:e.formMenu.MenuType,callback:function(t){e.$set(e.formMenu,"MenuType",t)},expression:"formMenu.MenuType"}})],1),e._v(" "),o("FormItem",{attrs:{label:"备注",prop:"Remark"}},[o("Input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:5},placeholder:"请添加菜单备注"},model:{value:e.formMenu.Remark,callback:function(t){e.$set(e.formMenu,"Remark",t)},expression:"formMenu.Remark"}})],1),e._v(" "),o("FormItem",{staticClass:"menu-footer"},[o("Button",{attrs:{type:"primary",loading:e.loading},on:{click:function(t){e.handleMenu("formMenu")}}},[e.loading?o("span",[e._v("加载中...")]):o("span",[e._v(e._s(e.btnText))])]),e._v(" "),o("Button",{on:{click:function(t){e.handleCancle("formMenu")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]};var c={data:function(){return{roleList:[],chooseRole:[],chooseRolesID:"",loading:!1,message:{show:!0,tip:""}}},methods:{handleRole:function(){var e=this;if(0===this.chooseRole.length)this.message.show=!0,this.message.tip="请至少选择一位角色",setTimeout(function(){e.message.show=!1,e.message.tip=""},2e3);else if(this.chooseRole.length>1)this.message.show=!0,this.message.tip="只能选择一位角色",setTimeout(function(){e.message.show=!1,e.message.tip=""},2e3);else{for(var t=0;t<this.roleList.length;t++)this.chooseRole[0]===this.roleList[t].RoleName&&(this.chooseRolesID=this.roleList[t].RoleID);this.$emit("closeRoleModal",this.chooseRole,String(this.chooseRolesID))}},handleCancle:function(){this.$emit("closeRoleModal")}},mounted:function(){var e=this;this.$bus.on("getRoles",function(t){t.map(function(e,t){e.IsChecked&&chooseRole.push(e.RoleName)}),e.roleList=t,console.log("角色",e.roleList)})}},h={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"roleContainer"},[o("Card",{staticClass:"roleCard",attrs:{border:""}},[o("CheckboxGroup",{staticClass:"roleGroup",model:{value:e.chooseRole,callback:function(t){e.chooseRole=t},expression:"chooseRole"}},e._l(e.roleList,function(t,n){return o("Checkbox",{key:n,attrs:{label:t.RoleName}},[o("span",[e._v(e._s(t.RoleName))])])}))],1),e._v(" "),e.message.show?o("p",{staticClass:"alertContent",attrs:{type:"error"}},[e._v(e._s(e.message.tip))]):e._e(),e._v(" "),o("div",{staticClass:"role-footer"},[o("Button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleRole}},[e.loading?o("span",[e._v("加载中...")]):o("span",[e._v("确定")])]),e._v(" "),o("Button",{on:{click:e.handleCancle}},[e._v("取消")])],1)],1)},staticRenderFns:[]};var d={data:function(){return{serviceData:{serviceNumber:"1"},menuList:[],allMenus:[],showCheckbox:!1,isShow:!1,checkNode:"",openMenu:!1,openRole:!1,editData:{},menuTitle:"",btnValue:"",transferRole:!1,checkedRole:[],checkedRoleId:""}},methods:{getMenuDatas:function(){var e=this;Object(i.h)("/Menus/GetAllMenus",this.serviceData).then(function(t){if(console.log("成功",t),200===t.status&&t.data.Success){e.menuList=t.data.Data;var o=[];console.log("有层级菜单",e.menuList),function e(t){for(var n in t)o.push(t[n]),t[n].title=t[n].Name,0!==t[n].ChildNodes.length&&e(t[n].ChildNodes)}(e.menuList),e.allMenus=o,e.allMenus.push({ID:0,Name:"Root"}),console.log("无层级菜单",e.allMenus)}else e.$Message.error("未成功获取菜单信息，请再试！")}).catch(function(t){console.log("失败",t),e.$Message.error("未成功获取菜单信息，请再试！")})},leftChick:function(e){0===e.button&&(this.isShow=!1),this.openRole=!1,this.openMenu=!1},showMenu:function(e){e.preventDefault(),this.isShow=!0;var t=e.clientX,o=e.clientY,n=document.getElementById("rightMenu"),s=document.getElementById("mainMenu");this.checkNode=e.path[0].innerText,n.style.top=o-s.offsetTop+10+"px",n.style.left=t-s.offsetLeft+10+"px"},menuBtn:function(e){var t=this;"add"===e?(this.editData={},this.btnValue="新增",this.menuTitle="新增菜单"):(this.allMenus.map(function(e,o){e.Name===t.checkNode&&(t.editData=e)}),this.btnValue="保存",this.menuTitle="编辑菜单"),this.openMenu=!0},closeMenu:function(){this.openMenu=!1},chooseRole:function(){this.openRole=!0},closeRole:function(e,t){e&&(this.checkedRole=e,this.checkedRoleId=t),this.openRole=!1},delBtn:function(){var e=this,t=void 0;this.allMenus.map(function(o,n){o.Name===e.checkNode&&(t=o.ID)}),Object(i.a)("/Menus/DeleteMenus",{serviceNumber:this.serviceData.serviceNumber,menuId:t}).then(function(t){console.log("成功",t),200===t.status&&t.data.Success?(e.$Message.success("删除菜单成功"),e.getMenuDatas()):e.$Message.error("删除菜单失败，请再试！")}).catch(function(t){console.log("失败",t),e.$Message.error("删除菜单失败，请再试！")})}},components:{menuModal:o("VU/8")(l,u,!1,function(e){o("1kgP")},"data-v-f788a65a",null).exports,roleModal:o("VU/8")(c,h,!1,function(e){o("w9Io")},"data-v-15b9d98e",null).exports},beforeCreate:function(){},created:function(){this.getMenuDatas()}},m={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"menuContainer",attrs:{id:"mainMenu"},on:{mouseup:e.leftChick}},[o("div",{staticClass:"menuTreeBox",on:{contextmenu:e.showMenu}},[o("Breadcrumb",{staticClass:"menuBread"},[o("BreadcrumbItem",{attrs:{to:"/"}},[o("Icon",{attrs:{type:"ios-home"}}),e._v(" 系统首页\n        ")],1),e._v(" "),o("BreadcrumbItem",{attrs:{to:"/menu"}},[o("Icon",{attrs:{type:"md-menu"}}),e._v(" 菜单管理\n        ")],1)],1),e._v(" "),o("Tooltip",{attrs:{content:"点击右键可对菜单进行操作",placement:"right-start"}},[o("Tree",{staticClass:"menuTree",attrs:{data:e.menuList,"show-checkbox":e.showCheckbox,multiple:"","children-key":"ChildNodes"}})],1)],1),e._v(" "),o("div",{staticClass:"handleAdd"},[o("Button",{attrs:{type:"primary",icon:"md-add"},on:{click:function(t){e.menuBtn("add")}}},[e._v("新增菜单")])],1),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.isShow,expression:"isShow"}],staticClass:"handleEdit",attrs:{id:"rightMenu"}},[o("Button",{attrs:{icon:"ios-create",size:"small"},on:{click:function(t){e.menuBtn("edit")}}},[e._v("编辑菜单")]),e._v(" "),o("Button",{attrs:{icon:"ios-trash",size:"small"},on:{click:e.delBtn}},[e._v("删除菜单")])],1),e._v(" "),o("Modal",{attrs:{title:e.menuTitle,styles:{top:"10px"},width:"50","footer-hide":""},model:{value:e.openMenu,callback:function(t){e.openMenu=t},expression:"openMenu"}},[o("menuModal",{attrs:{checkedRole:e.checkedRole,checkedRoleId:e.checkedRoleId,btnValue:e.btnValue,parentList:e.allMenus,editData:e.editData},on:{openRoleModal:e.chooseRole,closeMenuModal:e.closeMenu,reGetMenu:e.getMenuDatas}}),e._v(" "),o("Drawer",{attrs:{title:"选择角色",width:"50",transfer:e.transferRole,inner:""},model:{value:e.openRole,callback:function(t){e.openRole=t},expression:"openRole"}},[o("roleModal",{on:{closeRoleModal:e.closeRole}})],1)],1)],1)},staticRenderFns:[]};var f=o("VU/8")(d,m,!1,function(e){o("Rebg")},"data-v-66bfa465",null);t.default=f.exports},Rebg:function(e,t){},w9Io:function(e,t){}});
//# sourceMappingURL=1.15b8e35fcfb5544da39d.js.map